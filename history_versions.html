<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes">
    <title>历史版本 · 氢风启动器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
        }

        body {
            background: linear-gradient(145deg, #f0f4fa 0%, #e6ecf5 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 30px 20px;
        }

        .main-wrapper {
            max-width: 1200px;
            width: 100%;
            background-color: rgba(255,255,255,0.75);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            border-radius: 48px 48px 36px 36px;
            box-shadow: 0 25px 45px -12px rgba(0,20,40,0.35), 0 2px 8px rgba(0,0,0,0.05);
            padding: 30px 35px 50px 35px;
            border: 1px solid rgba(255,255,255,0.7);
        }

        .history-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.5);
            backdrop-filter: blur(4px);
            padding: 10px 22px;
            border-radius: 50px;
            border: 1px solid rgba(70,120,160,0.3);
            color: #1d4d6b;
            text-decoration: none;
            font-weight: 500;
            font-size: 1.2rem;
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(0,20,30,0.05);
        }
        .back-link:hover {
            background: white;
            border-color: #2f6b8f;
            color: #0a3142;
            box-shadow: 0 10px 18px -8px rgba(20,80,120,0.5);
            transform: translateX(-3px);
        }
        .back-link span {
            font-size: 1.5rem;
            line-height: 1;
        }

        .page-title {
            font-size: 2.4rem;
            font-weight: 600;
            color: #113946;
            margin-left: 30px;
            letter-spacing: 1px;
            position: relative;
        }
        .page-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 70px;
            height: 4px;
            background: linear-gradient(90deg, #2f6b8f, #b1d0e8);
            border-radius: 4px;
        }

        .versions-container {
            margin: 35px 0 20px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .version-card {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(8px);
            border-radius: 28px;
            padding: 25px 30px;
            box-shadow: 0 12px 20px -12px rgba(0,30,50,0.2);
            border: 1px solid rgba(255,255,255,0.8);
            transition: all 0.2s;
        }
        .version-card:hover {
            background: rgba(255,255,255,0.85);
            box-shadow: 0 18px 28px -12px #1c4e6e;
            transform: translateY(-2px);
        }

        .version-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .version-name {
            font-size: 1.9rem;
            font-weight: 700;
            color: #0b3b4e;
            letter-spacing: 0.5px;
        }
        .latest-tag {
            background: #1a5f7a;
            color: white;
            font-size: 1rem;
            padding: 5px 18px;
            border-radius: 50px;
            font-weight: 400;
            white-space: nowrap;
        }

        .version-log {
            font-size: 1.2rem;
            line-height: 1.6;
            color: #1e3a4a;
            background: #f3f9ff;
            padding: 18px 22px;
            border-radius: 22px;
            border: 1px solid #c7ddee;
            margin: 18px 0 20px;
            white-space: pre-wrap;
            word-break: break-word;
        }

        /* 改进：使用网格布局，两列等分，消除右侧空白 */
        .download-row {
            display: grid;
            grid-template-columns: repeat(2, minmax(140px, 1fr));
            gap: 20px;
            border-top: 1px dashed #b0cddf;
            padding-top: 18px;
            margin-top: 5px;
        }
        .download-item-small {
            text-align: center;
            background: rgba(255,255,255,0.5);
            border-radius: 20px;
            padding: 15px 12px 12px 12px;
            transition: 0.2s;
            border: 1px solid rgba(255,255,255,0.6);
            width: 100%;
        }
        .download-item-small:hover {
            background: white;
            box-shadow: 0 10px 18px -12px #1c4e6e;
            transform: translateY(-3px);
        }
        .download-item-small a {
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .download-icon-small {
            width: 100%;
            max-width: 140px;
            height: auto;
            border-radius: 16px;
            border: 1px solid rgba(150,180,200,0.3);
            background-color: #eef4f9;
            min-height: 60px;
            object-fit: contain;
            margin: 0 auto;
        }
        .download-icon-small.error {
            background: #d9e2ec;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2f627c;
            font-size: 0.9rem;
            padding: 12px 0;
        }
        .download-item-small span {
            font-size: 1.1rem;
            font-weight: 550;
            color: #1d4d6b;
            background: rgba(230,240,250,0.7);
            padding: 4px 14px;
            border-radius: 30px;
            border: 1px solid rgba(80,130,170,0.2);
            display: inline-block;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 35px;
            flex-wrap: wrap;
        }
        .page-btn {
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(70,120,160,0.3);
            color: #1d4d6b;
            font-size: 1.2rem;
            font-weight: 500;
            padding: 10px 25px;
            border-radius: 40px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0,20,30,0.05);
            min-width: 100px;
            text-align: center;
        }
        .page-btn:hover:not(:disabled) {
            background: white;
            border-color: #2f6b8f;
            color: #0a3142;
            box-shadow: 0 10px 18px -10px rgba(20,80,120,0.5);
            transform: scale(1.02);
        }
        .page-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            pointer-events: none;
        }
        .page-info {
            font-size: 1.2rem;
            color: #2b5f7a;
            background: rgba(255,255,255,0.4);
            padding: 8px 20px;
            border-radius: 40px;
            backdrop-filter: blur(2px);
        }

        .loading-skeleton {
            color: #7a9eb5;
            font-style: italic;
            animation: pulse 1.5s infinite ease-in-out;
        }
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .no-versions {
            text-align: center;
            padding: 60px 20px;
            background: rgba(255,255,255,0.5);
            border-radius: 40px;
            color: #2f627c;
            font-size: 1.4rem;
        }

        .footnote {
            margin-top: 45px;
            text-align: center;
            color: #527a94;
            font-size: 0.95rem;
            border-top: 1px solid rgba(90,130,160,0.2);
            padding-top: 22px;
        }
        .footnote a {
            color: #1f5f83;
            text-decoration: none;
            border-bottom: 1px dotted;
            transition: color 0.2s;
        }
        .footnote a:hover {
            color: #0b3140;
            border-bottom-style: solid;
        }

        @media (max-width: 700px) {
            .main-wrapper { padding: 25px 18px; }
            .history-header { flex-direction: column; align-items: flex-start; gap: 15px; }
            .page-title { margin-left: 0; font-size: 2rem; }
            .version-name { font-size: 1.6rem; }
            .version-card { padding: 20px; }
            .download-row { gap: 15px; }
        }
        @media (max-width: 500px) {
            .download-row { grid-template-columns: 1fr; } /* 超小屏单列 */
        }
    </style>
</head>
<body>
<div class="main-wrapper">
    <div class="history-header">
        <a href="index.html" class="back-link">
            <span>←</span> 返回首页
        </a>
        <div class="page-title">历史版本</div>
    </div>

    <div id="versionsContainer" class="versions-container">
        <div class="loading-skeleton" style="text-align:center; padding:40px;">加载版本历史中...</div>
    </div>

    <div id="paginationControls" class="pagination" style="display: none;">
        <button class="page-btn" id="prevPage" disabled>← 上一页</button>
        <span class="page-info" id="pageInfo"></span>
        <button class="page-btn" id="nextPage" disabled>下一页 →</button>
    </div>

    <div class="footnote">
        ⚡ 氢风启动器 · 官方站    |    <a href="index.html">返回首页</a>
    </div>
</div>

<script>
    (function() {
        const PAGE_SIZE = 5;
        const container = document.getElementById('versionsContainer');
        const paginationDiv = document.getElementById('paginationControls');
        const prevBtn = document.getElementById('prevPage');
        const nextBtn = document.getElementById('nextPage');
        const pageInfo = document.getElementById('pageInfo');

        let allVersions = [];
        let currentPage = 1;
        let totalPages = 0;

        const DEFAULT_VERSIONS = {
            "versions": {
                "0": {
                    "name": "v1.0.0-beta",
                    "log": "第一个版本！！！"
                }
            }
        };

        function fetchVersions() {
            fetch('resource/versions.json', { cache: 'no-cache' })
                .then(response => {
                    if (!response.ok) throw new Error('加载失败');
                    return response.json();
                })
                .then(data => {
                    processVersionData(data);
                })
                .catch(() => {
                    processVersionData(DEFAULT_VERSIONS);
                });
        }

        function processVersionData(data) {
            if (!data || !data.versions || typeof data.versions !== 'object') {
                showEmptyState();
                return;
            }

            const versionsObj = data.versions;
            const rawArray = Object.keys(versionsObj).map(key => {
                const item = versionsObj[key];
                return {
                    key: key,
                    name: item.name || '未知版本',
                    log: item.log || '暂无更新日志'
                };
            });

            rawArray.sort((a, b) => {
                const numA = Number(a.key);
                const numB = Number(b.key);
                if (!isNaN(numA) && !isNaN(numB)) {
                    return numB - numA;
                }
                return b.name.localeCompare(a.name);
            });

            allVersions = rawArray;
            if (allVersions.length > 0) {
                allVersions[0].isLatest = true;
            }

            totalPages = Math.ceil(allVersions.length / PAGE_SIZE) || 1;
            currentPage = 1;
            renderPage(1);
        }

        function renderPage(page) {
            if (!allVersions.length) {
                showEmptyState();
                return;
            }

            const start = (page - 1) * PAGE_SIZE;
            const end = Math.min(start + PAGE_SIZE, allVersions.length);
            const pageData = allVersions.slice(start, end);

            let htmlStr = '';
            pageData.forEach(ver => {
                const isLatest = ver.isLatest ? '<span class="latest-tag">最新</span>' : '';
                const safeLog = ver.log.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>');

                const windowsFileName = `resource/qing-feng_setup_windows_${ver.name}.exe`;
                const androidFileName = `resource/qing-feng_setup_android_${ver.name}.apk`;

                htmlStr += `
                    <div class="version-card">
                        <div class="version-header">
                            <span class="version-name">${ver.name}</span>
                            ${isLatest}
                        </div>
                        <div class="version-log">${safeLog}</div>
                        <div class="download-row">
                            <div class="download-item-small">
                                <a href="${windowsFileName}" download="qing-feng_setup_windows_${ver.name}.exe">
                                    <img src="image/download-windows.png" alt="Windows下载" class="download-icon-small" 
                                         onerror="this.classList.add('error'); this.src='data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22140%22%20height%3D%2270%22%20viewBox%3D%220%200%20140%2070%22%3E%3Crect%20width%3D%22140%22%20height%3D%2270%22%20fill%3D%22%233b6f8c%22%2F%3E%3Ctext%20x%3D%2270%22%20y%3D%2240%22%20font-size%3D%2218%22%20fill%3D%22%23ffffff%22%20text-anchor%3D%22middle%22%20dominant-baseline%3D%22middle%22%3EWin%3C%2Ftext%3E%3C%2Fsvg%3E';">
                                    <span>Windows版</span>
                                </a>
                            </div>
                            <div class="download-item-small">
                                <a href="${androidFileName}" download="qing-feng_setup_android_${ver.name}.apk">
                                    <img src="image/download-android.png" alt="Android下载" class="download-icon-small"
                                         onerror="this.classList.add('error'); this.src='data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22140%22%20height%3D%2270%22%20viewBox%3D%220%200%20140%2070%22%3E%3Crect%20width%3D%22140%22%20height%3D%2270%22%20fill%3D%22%233b6f8c%22%2F%3E%3Ctext%20x%3D%2270%22%20y%3D%2240%22%20font-size%3D%2218%22%20fill%3D%22%23ffffff%22%20text-anchor%3D%22middle%22%20dominant-baseline%3D%22middle%22%3EAndroid%3C%2Ftext%3E%3C%2Fsvg%3E';">
                                    <span>Android版</span>
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = htmlStr;
            updatePagination(page);
        }

        function updatePagination(page) {
            currentPage = page;
            if (totalPages <= 1) {
                paginationDiv.style.display = 'none';
                return;
            }
            paginationDiv.style.display = 'flex';
            pageInfo.textContent = `第 ${currentPage} / ${totalPages} 页`;

            prevBtn.disabled = (currentPage <= 1);
            nextBtn.disabled = (currentPage >= totalPages);

            prevBtn.replaceWith(prevBtn.cloneNode(true));
            nextBtn.replaceWith(nextBtn.cloneNode(true));

            document.getElementById('prevPage').addEventListener('click', (e) => {
                e.preventDefault();
                if (currentPage > 1) {
                    renderPage(currentPage - 1);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            });
            document.getElementById('nextPage').addEventListener('click', (e) => {
                e.preventDefault();
                if (currentPage < totalPages) {
                    renderPage(currentPage + 1);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            });
        }

        function showEmptyState() {
            container.innerHTML = '<div class="no-versions">暂无版本信息</div>';
            paginationDiv.style.display = 'none';
        }

        fetchVersions();
    })();
</script>
</body>
</html>